<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Login</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-secondary text-white p-3">
<nav class="navbar navbar-expand-lg bg-dark navbar-dark">
    <div class="container-fluid">
        <a class="navbar-brand" href="#">Welcome to the Database!</a>
    </div>
</nav>
<div class="container mt-5">
    <h2 class="text-center">Enter details</h2>
    <form id="login-form" class="mt-4">
        <div class="mb-3">
            <label for="username" class="form-label">Email address</label>
            <input type="email" class="form-control" id="username" required>
        </div>
        <div class="mb-3">
            <label for="password" class="form-label">Password</label>
            <input type="password" class="form-control" id="password" required>
        </div>
        <p class="form-text text-white">Must be 8-20 characters long.</p>
        <a href="/forgot" class="btn btn-primary text-black">Forgot password?</a>
        <div class="d-grid mt-3">
            <button type="submit" class="btn btn-success btn-lg text-black">Login</button>
        </div>
    </form>
    <p id="msg" class="mt-3"></p>
    <p class="form-text mt-3">
        Don't have an account?
        <a href="/register" class="btn btn-warning btn-sm text-black">Register</a>
    </p>
</div>
<script>
    document.addEventListener("DOMContentLoaded", function () {
        const form = document.getElementById("login-form");
        const msg = document.getElementById("msg");
        form.addEventListener("submit", async function (e) {
            e.preventDefault();
            msg.textContent = "";
            const username = document.getElementById("username").value.trim();
            const password = document.getElementById("password").value;
            if (!username || !password) {
                msg.textContent = "Please fill all fields.";
                return;
            }
            if (password.length < 8) {
                msg.textContent = "Password must be at least 8 characters.";
                return;
            }
            const response = await fetch("/login", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ username, password })
            });
            const data = await response.json();
            if (data.success && data.token) {
                localStorage.setItem('jwt_token',data.token);
                window.location.href = "/dashboard";
            } else{
                msg.textContent = data.message;
            }
        });
    });
</script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>